@model IEnumerable<Bookit.Models.BookViewModel>

@{
    ViewData["Title"] = "Gallery";
}

<h2>Book Gallery</h2>

<form method="get" class="form-inline">
    <input name="term" value="@ViewData[" term"]" class="form-control" style="width:300px" />
    <button type="submit" class="btn btn-primary">Search</button>
</form>

<hr />

@foreach (var book in Model)
{
    <partial name="_BookItemVM" model="book" />
    <hr />
}

@section scripts{
    <script>
        let basket = {
            books: []
        }

        $(".addToBasket").click(function () {
            var book = $(this).attr("data-book");

            addToBasket(JSON.parse(book));

        });
        function addToBasket(book) {

            if (localStorage && localStorage.getItem('basket')) {
                basket = JSON.parse(localStorage.getItem('basket'));

                var found = false;
                for (var i = 0; i < basket.books.length; i++) {
                    if (basket.books[i].Id == book.Id) {
                        basket.books[i].Count++;
                        found = true;
                        break;
                    }
                }

                if (!found) {
                    book.Count = 1;
                    basket.books.push(book);
                }
                localStorage.setItem('basket', JSON.stringify(basket));
            } else {

                basket.books.push(book);
                localStorage.setItem('basket', JSON.stringify(basket));
            }
        }

        function bookAlreadyExists(basket, book) {
            for (var i = 0; i < basket.books; i++) {
                if (basket.books[i].Id == book.Id) {
                    return true;
                }
            }
            return false;
        }
    </script>
}
